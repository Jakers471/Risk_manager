# OrderBook Guide

This guide covers comprehensive Level 2 market depth analysis using ProjectX Python SDK v3.3.4+. The OrderBook component provides real-time market microstructure analysis with advanced features including spoofing detection, iceberg identification, and volume profile analysis.

## Overview

The OrderBook provides complete Level 2 market depth analysis with real-time updates via WebSocket. It includes sophisticated market microstructure analysis tools designed for institutional-level trading and market making applications.

### Key Features

- **Level 2 Market Depth**: Real-time bid/ask levels with volume
- **Market Microstructure Analysis**: Spread analysis, depth imbalance, and liquidity metrics
- **Spoofing Detection**: 6 different spoofing patterns with confidence scoring
- **Iceberg Detection**: Identify hidden order algorithms
- **Volume Profile**: Price-volume distribution analysis
- **Trade Flow Analysis**: Real-time trade classification and flow
- **Memory Management**: Efficient sliding window data management

## Getting Started

### Basic Setup

```python
import asyncio
from project_x_py import TradingSuite

async def basic_orderbook_setup():
    # Enable OrderBook feature
    suite = await TradingSuite.create(
        "MNQ",
        features=["orderbook"],  # Enable Level 2 data
        initial_days=1
    )

    # OrderBook is automatically initialized and connected
    orderbook = suite.orderbook

    print("OrderBook connected and receiving Level 2 data")

    # Get current best bid/ask
    best_prices = await orderbook.get_best_bid_ask()
    print(f"Best Bid: ${best_prices['bid']:.2f}")
    print(f"Best Ask: ${best_prices['ask']:.2f}")
    print(f"Spread: ${best_prices['spread']:.2f}")
```

### OrderBook Data Structure

The OrderBook maintains real-time Level 2 data with the following structure:

```python
async def examine_orderbook_structure():
    suite = await TradingSuite.create("MNQ", features=["orderbook"])
    orderbook = suite.orderbook

    # Get bid levels (sorted by price descending)
    bids = await orderbook.get_orderbook_bids(levels=10)
    print("Bid Levels (highest first):")
    print(bids.head())

    # Get ask levels (sorted by price ascending)
    asks = await orderbook.get_orderbook_asks(levels=10)
    print("Ask Levels (lowest first):")
    print(asks.head())

    # Full orderbook snapshot
    full_book = await orderbook.get_full_orderbook()
    print(f"Full book - Bid levels: {len(full_book['bids'])}, Ask levels: {len(full_book['asks'])}")
```

## Market Depth Analysis

### Bid/Ask Spread Analysis

```python
async def spread_analysis():
    suite = await TradingSuite.create("MNQ", features=["orderbook"])
    orderbook = suite.orderbook

    # Real-time spread monitoring
    spread_history = []

    async def monitor_spread():
        """Monitor spread changes in real-time."""

        for _ in range(20):  # Monitor for 20 updates
            best_prices = await orderbook.get_best_bid_ask()

            if best_prices['bid'] and best_prices['ask']:
                spread = best_prices['spread']
                mid_price = (best_prices['bid'] + best_prices['ask']) / 2
                spread_bps = (spread / mid_price) * 10000  # Basis points

                spread_history.append({
                    'timestamp': datetime.now(),
                    'spread': spread,
                    'spread_bps': spread_bps,
                    'bid': best_prices['bid'],
                    'ask': best_prices['ask']
                })

                print(f"Spread: ${spread:.2f} ({spread_bps:.1f} bps) | Bid: ${best_prices['bid']:.2f} Ask: ${best_prices['ask']:.2f}")

                # Spread alerts
                if spread > 5.0:  # Wide spread for MNQ
